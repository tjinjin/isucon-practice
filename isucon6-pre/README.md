## ISUCON対策虎の巻

## ISUCON2016用対策
- 今回はIaaSとしてMicrosoft Azure。インフラ担当は最低限使い方を覚える。
- OSはUbuntu。supervisordでデーモン化すると思われるので、触れる用に。自分の使いやすいツールに変えても良い
- Ruby以外の実装もあるが、みんな触れる言語がいいと思う。sinatraでの実装と思われる

## 戦略
- deploy環境と整える
- 各種パフォーマンス計測ツールを導入
- 各人が自由にできる環境があるといい。（SQLのチューニングにdbdump取るとか）
- 各種ログを出力（slow-queryとか）
- benchを動かす前にログの退避は必須
- ボトルネックを特定して1つずつ崩していく（どんどんボトルネックが移り変わっていく）
- 基本的な設定変更は初回ベンチ後にすぐやる（nginx/mysqlなど）
- topでもいいけどmackerelなりnetdataなりで性能をチューニングできるようにする

## 各レイヤ毎の対策
### OS


### Nginx
- アプリに投げずに前段で処理する
- gzip圧縮する
- 静的ファイルは前段で配信
- UNIX socketを使う
- リクエストによってはhttp2のサーバへの入換もあり。すぐに入替えデキるように手順を抑えておく。
- HTTPリクエスト・レスポンスヘッダを見てキャッシュを考える


### Mysql
- 古かったらアップデートとか
- index貼る
- パラメータのチューニング
- mysqlで重い処理をさせない
- socketを使う
- 基本的になるべくmysqlへのアクセスを減らす
- warmup処理は必須
- mysql辞めてpostgresにとかもあり

### application
- ruby古かったらアップデートとか（動くように変更必要かも）
- 如何にキャッシュをするかの勝負
- 無駄なselectとかしない
- メモ化をうまく使う
- オンメモリでなるべく解決
- N+1対応
- Redis等のキャッシュサーバをうまく使う


## 流れ
### 開始後


### 開始中盤


### 終了間際
- サーバを再起動した時に安定してスコアが出るようにする。サーバ起動後にベンチを動かして最終計測するので。
- ログとか開発で使ったようなデーモンを削除（ログは基本的にオフにする）
